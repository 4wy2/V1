<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
   <title>Ù…Ù†ØµØ© Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª | Ù†Ø§Ø¯ÙŠ Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©</title>

<link rel="icon" href="https://img.icons8.com/ios-filled/50/8042ff/lightning-bolt.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/plugin/customParseFormat.min.js"></script>
    <script>dayjs.extend(window.dayjs_plugin_customParseFormat);</script>

    <style>
    /* 1. Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
    :root { 
        --primary: #8042ff; 
        --accent: #1fc47c; 
        --danger: #ff4d6d; 
        --bg: #050816; 
        --glass-bg: rgba(13, 23, 56, 0.4);
        --row-bg: rgba(255, 255, 255, 0.02);
        --border-color: rgba(255, 255, 255, 0.08);
        --text-dim: rgba(255, 255, 255, 0.4);
    }
    
    body { 
        margin: 0; 
        background: var(--bg); 
        font-family: 'Tajawal', sans-serif; 
        color: white; 
        overflow-x: hidden; 
        direction: rtl; 
    }

    /* 2. Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠØ© (Ø§Ù„ÙÙ‚Ø§Ø¹Ø§Øª Ø§Ù„Ù…ØªØ­Ø±ÙƒØ©) */
    .bg-blobs { position: fixed; width: 100vw; height: 100vh; z-index: -1; overflow: hidden; }
    .blob { 
        position: absolute; 
        filter: blur(100px); 
        border-radius: 50%; 
        opacity: 0.15; 
        animation: move 20s infinite alternate ease-in-out; 
    }
    @keyframes move {
        from { transform: translate(0, 0) scale(1); }
        to { transform: translate(60px, 40px) scale(1.1); }
    }

    /* 3. Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .app { 
        width: min(950px, 96%); 
        margin: 40px auto; 
        background: var(--glass-bg); 
        backdrop-filter: blur(30px); 
        -webkit-backdrop-filter: blur(30px);
        border: 1px solid var(--border-color); 
        border-radius: 28px; 
        overflow: hidden; 
        box-shadow: 0 40px 80px rgba(0,0,0,0.7); 
    }

    .countdown-bar { 
    background: linear-gradient(135deg, rgba(128, 66, 255, 0.1), rgba(31, 196, 124, 0.1));
    border: 1px solid var(--border-color);
    padding: 15px 25px;
    text-align: center; 
    font-weight: 800; 
    font-size: 15px; 
    border-radius: 20px;
    margin: 20px auto;
    width: fit-content; /* Ù„ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰ Ù…Ù‚Ø§Ø³ Ø§Ù„Ù†Øµ */
    min-width: 300px;
    color: white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    display: none;
    animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

    /* 4. Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ø¬ÙˆØ§Ù„ */
.search-wrapper { 
    padding: 30px 15px 20px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
    text-align: center; 
}

.input-group { 
    position: relative; 
    max-width: 450px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„ÙŠÙƒÙˆÙ† Ø£Ø±Ø´Ù‚ */
    margin: 0 auto; 
}

.search-wrapper input { 
    width: 100%; 
    padding: 14px 45px 14px 20px; /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒÙ„ÙŠ (Padding) */
    border-radius: 16px; /* Ø²ÙˆØ§ÙŠØ§ Ø£Ù‚Ù„ Ø­Ø¯Ø© ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    border: 1px solid var(--border-color); 
    background: rgba(255, 255, 255, 0.05); 
    color: white; 
    outline: none; 
    font-size: 14px; /* Ø­Ø¬Ù… Ø®Ø· Ø£Ù†Ø³Ø¨ Ù„Ù„Ø¬ÙˆØ§Ù„ */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(10px);
    box-sizing: border-box; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø®Ø±ÙˆØ¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù† Ø§Ù„Ø­Ø§ÙˆÙŠØ© */
}

/* ØªØ£Ø«ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
.search-wrapper input:focus { 
    border-color: var(--primary); 
    background: rgba(128, 66, 255, 0.08);
    box-shadow: 0 0 20px rgba(128, 66, 255, 0.2);
}

.search-icon {
    position: absolute; 
    right: 15px; 
    top: 50%; 
    transform: translateY(-50%);
    color: var(--primary); 
    font-size: 16px; 
    opacity: 0.8; 
    transition: 0.3s;
}

/* Ø­Ø±ÙƒØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
.search-wrapper input:focus + .search-icon {
    transform: translateY(-50%) scale(1.1);
    color: var(--accent);
}
    /* 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¬Ø±ÙŠØ¯ (Ø§Ù„Ù…Ø³Ø·Ø±Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©) */
    .table-header, .row { 
        display: grid; 
        /* Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ø±Ù†Ø©ØŒ Ø§Ù„Ø¨Ù‚ÙŠØ© Ù‚ÙŠØ§Ø³Ø§Øª Ø«Ø§Ø¨ØªØ© Ù„Ù„Ù…Ø³Ø§ÙØ§Øª */
        grid-template-columns: 1fr 115px 110px 85px 55px; 
        gap: 12px; 
        align-items: center; 
        padding: 15px 25px;
        margin: 8px 15px;
    }

    .table-header { 
        background: rgba(255,255,255,0.03); 
        border-radius: 12px; 
        font-size: 11px; font-weight: 800;
        color: var(--text-dim); 
        text-align: center;
    }

    /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„ÙŠÙ…ÙŠÙ† ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ÙˆØ³Ø· */
    .table-header div, .row > div { text-align: center; }
    .table-header div:first-child, .row .info-group { text-align: right !important; padding-right: 10px; }

    .row { 
        background: var(--row-bg); border-radius: 16px; 
        border: 1px solid rgba(255,255,255,0.05); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .row:hover { background: rgba(255,255,255,0.06); transform: translateY(-3px); border-color: rgba(255,255,255,0.15); }

    /* 6. Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
    .btn-action { 
        border: none; width: 34px; height: 34px; border-radius: 10px; 
        cursor: pointer; display: flex; align-items: center; justify-content: center; 
        background: rgba(128, 66, 255, 0.15); color: #b794ff; transition: 0.3s; margin: 0 auto;
    }
    .btn-action:active { transform: scale(0.9); }
    .btn-save.saved { background: var(--danger); color: white; transform: rotate(90deg); }

    .section-title { 
        padding: 25px 25px 10px; font-size: 15px; color: var(--primary); 
        font-weight: 900; display: flex; align-items: center; gap: 10px; 
    }

    /* 7. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Ø­ÙŠÙ Ù„Ù„Ø¬ÙˆØ§Ù„ (Slim Mode) */
    @media (max-width: 600px) {
        .app { width: 100%; margin: 0; border-radius: 0; border: none; }
        
        .search-wrapper { padding: 30px 15px; }
        .search-wrapper h2 { font-size: 20px; }
        .search-wrapper input { padding: 14px 45px 14px 20px; font-size: 14px; }
        .search-icon { right: 15px; font-size: 15px; }

        .table-header, .row { 
            grid-template-columns: 1fr 65px 65px 50px 35px; 
            gap: 3px; padding: 10px 5px; margin: 3px 0; 
            border-radius: 0; border-left: none; border-right: none;
        }

        .table-header { font-size: 9px; padding: 8px 5px; }

        .row .label { font-size: 12px !important; font-weight: 800; color: #ffd166; }
        .row .sub { 
            font-size: 8px !important; line-height: 1.1;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        
        .date-box b { font-size: 10px !important; }
        .date-box small { font-size: 7px !important; }
        .time-box div { min-width: 62px !important; padding: 4px 0 !important; font-size: 8px !important; }
        
        .btn-action { width: 26px; height: 26px; border-radius: 6px; }
        .section-title { padding: 15px 10px 5px; font-size: 12px; }
    }
    /* 8. ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙØ§Ø±ØºØ© (Empty State) */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 80px 20px;
        text-align: center;
        color: var(--text-dim);
        animation: fadeIn 0.8s ease-out;
    }

    .empty-state i {
        font-size: 55px;
        margin-bottom: 20px;
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        opacity: 0.3; /* ØªØ¹Ø·ÙŠ Ø·Ø§Ø¨Ø¹Ø§Ù‹ Ù‡Ø§Ø¯Ø¦Ø§Ù‹ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© */
    }

    .empty-state p {
        font-size: 16px;
        font-weight: 500;
        margin: 0;
        letter-spacing: 0.5px;
        opacity: 0.6;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* ØªØ­Ø³ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø¬ÙˆØ§Ù„ */
    @media (max-width: 600px) {
        .empty-state { padding: 50px 15px; }
        .empty-state i { font-size: 40px; }
        .empty-state p { font-size: 13px; }
    }
        /* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø§Ù„Ù…Ø·ÙˆØ± */
.back-home {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    padding: 10px 18px;
    border-radius: 12px;
    color: white;
    text-decoration: none;
    font-size: 13px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: 0.3s;
    z-index: 100;
}

.back-home:hover {
    background: rgba(128, 66, 255, 0.2);
    border-color: var(--primary);
    transform: translateX(-5px); /* Ø­Ø±ÙƒØ© Ø®ÙÙŠÙØ© Ù„Ù„ÙŠÙ…ÙŠÙ† Ù„Ø£Ù† Ø§Ù„Ø§ØªØ¬Ø§Ù‡ RTL */
}

/* ØªØ¹Ø¯ÙŠÙ„ Ù…ÙƒØ§Ù†Ù‡ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ Ù„ÙŠØµØ¨Ø­ Ø£Ø±Ø´Ù‚ */
@media (max-width: 600px) {
    .back-home {
        top: 15px;
        right: 15px;
        padding: 8px 12px;
        font-size: 11px;
    }
}
</style>
</head>
<body>
    <a href="https://Engineer-ee.com" class="back-home">
    <i class="fa-solid fa-arrow-right"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø© 
</a>

    <div class="bg-blobs">
    <div class="blob" style="width:600px; height:600px; background:var(--primary); top:-200px; right:-150px;"></div>
    <div class="blob" style="width:500px; height:500px; background:var(--accent); bottom:-150px; left:-100px;"></div>
    <div class="blob" style="width:300px; height:300px; background:var(--primary); top:40%; left:30%; opacity: 0.05;"></div>
</div>

<main class="app">
    
    
    <div class="search-wrapper">
    <div class="ee-logo-area" style="margin-bottom: 15px;">
        <i class="fa-solid fa-bolt-lightning" style="color: var(--primary); font-size: 40px; filter: drop-shadow(0 0 12px var(--primary));"></i>
    </div>
    
    <p style="font-size: 11px; opacity: 0.7; margin: 0 0 20px 0; font-weight: 700; letter-spacing: 2px; color: var(--accent); text-transform: uppercase;">
        Electrical Engineering Club
    </p>
    
    <div id="countdown" class="countdown-bar"></div>
    
    <div class="input-group">
        <input id="searchInput" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ø¯Ø© (EE201)..." autocomplete="off">
        <i class="fa-solid fa-magnifying-glass search-icon"></i> 
    </div>
</div>

    <div id="myScheduleSection" style="display:none; margin-bottom: 30px;">
        <div class="section-title">
            <i class="fa-solid fa-star-half-stroke" style="color:#ffd166"></i> 
            Ø¬Ø¯ÙˆÙ„Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ
        </div>
        <div class="table-header">
            <div>Ø§Ù„Ù…Ø§Ø¯Ø©</div>
            <div>Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
            <div>Ø§Ù„ÙˆÙ‚Øª</div>
            <div>Ø§Ù„Ù…Ø¯Ø©</div>
            <div>Ø­Ø°Ù</div>
        </div>
        <div id="myRows"></div>
    </div>

    <div class="section-title">
        <i class="fa-solid fa-list-check"></i> 
        Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
    </div>
    <div id="searchHeader" class="table-header" style="display:none;">
        <div>Ø§Ù„Ù…Ø§Ø¯Ø©</div>
        <div>Ø§Ù„ØªØ§Ø±ÙŠØ®</div>
        <div>Ø§Ù„ÙˆÙ‚Øª</div>
        <div>Ø§Ù„Ù…Ø¯Ø©</div>
        <div>Ø­ÙØ¸</div>
    </div>
    
    <div id="searchRows">
        <div class="empty-state">
            <i class="fa-solid fa-keyboard"></i>
            <p>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¢Ù† Ø¹Ù† Ø§Ø®ØªØ¨Ø§Ø±Ùƒ</p>
        </div>
    </div>
</main>

<script>
    let allExams = [];
    let myExams = JSON.parse(localStorage.getItem('yic_saved_exams')) || [];

    async function loadData() {
    const searchRows = document.getElementById('searchRows');
    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù…Ø¹ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙØ±Ø¹
    const API_URL = 'https://examdata.mohammed-rasasi.workers.dev/?campus=main';

    try {
        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø³Ø±Ø¹Ø©
        const cachedData = localStorage.getItem('all_exams_cache');
        if (cachedData) {
            allExams = JSON.parse(cachedData);
            renderMySchedule();
        }

        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±');

        const data = await response.json();
        
        // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù€ JSON ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…ØµÙÙˆÙØ© Ø¨Ø§Ø³Ù… exams_list
        if (data.exams_list) {
            allExams = data.exams_list.map(ex => ({
                ...ex,
                code: ex.code.trim(),
                course_name: ex.course_name.trim()
            }));

            localStorage.setItem('all_exams_cache', JSON.stringify(allExams));
            renderMySchedule();
            
            if (searchRows) {
                searchRows.innerHTML = '<div style="text-align: center; padding: 60px; opacity: 0.3;">ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­</div>';
            }
        }
    } catch (error) {
        console.error("Error:", error);
        if (!allExams || allExams.length === 0) {
            searchRows.innerHTML = `<div style="text-align: center; padding: 60px; color: var(--danger);">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</div>`;
        }
    }
}

    function createRow(ex, isSaved) {
    const row = document.createElement('div');
    row.className = 'row';
    
    // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª
    const dateParts = ex.date.split(' ');
    const dateNum = dateParts[0] || '';
    
    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„ÙŠÙˆÙ… ÙƒØ§Ù…Ù„Ø§Ù‹ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©
    const testDate = dayjs(dateNum, 'DD-MM-YYYY');
    const fullDayName = testDate.isValid() ? testDate.format('dddd') : ''; 
    
    const today = dayjs().startOf('day');
    const diffDays = testDate.diff(today, 'day');

    let statusColor = 'var(--accent)'; 
    if (diffDays === 0) statusColor = 'var(--danger)'; 
    else if (diffDays > 0 && diffDays <= 3) statusColor = '#ff9f43';

    const timeParts = ex.time.split(/[-â€“â€”]/); 
    const startTime = timeParts[0] ? timeParts[0].trim() : ex.time;
    const endTime = timeParts[1] ? timeParts[1].trim() : '';
    
    const isPM = ex.time.toUpperCase().includes('PM');
    const timeColor = isPM ? '#ff9f43' : '#00d2d3';

    // 2. Ø¨Ù†Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµÙ Ø§Ù„Ù…ØªÙ†Ø§Ø³Ù‚
    row.innerHTML = `
        <div class="info-group" style="text-align: right; display: flex; flex-direction: column; justify-content: center; padding-right: 20px; flex: 1.4; overflow: hidden;">
            <span class="label" style="color: #ffd166; font-size: 15px; font-weight: 900; line-height: 1.2; white-space: nowrap; text-overflow: ellipsis; overflow: hidden;">
                ${ex.code}
            </span>
            <span class="sub" style="font-size: 9px; opacity: 0.8; font-weight: 500; display: block; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; margin-top: 2px; color: #fff;">
                ${ex.course_name}
            </span>
        </div>

        <div class="date-box" style="display: flex; justify-content: center; align-items: center; gap: 6px; flex: 1.2; border-right: 1px solid rgba(255,255,255,0.05);">
            <div style="text-align: left;">
                <b style="display: block; font-size: 11px; color: #fff; line-height: 1;">${dateNum}</b>
                <small style="font-size: 8px; color: ${statusColor}; font-weight: 800; display: block; text-align: right; text-transform: uppercase; letter-spacing: 0.5px;">
                    ${fullDayName}
                </small>
            </div>
            <div style="width: 2px; height: 18px; background: ${statusColor}; opacity: 0.6; border-radius: 10px;"></div>
        </div>

        <div class="time-box" style="display: flex; justify-content: center; align-items: center; flex: 1.1;">
            <div style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); padding: 4px 6px; border-radius: 8px; width: 100%; max-width: 85px; text-align: center;">
                <div style="font-size: 10px; font-weight: 800; color: ${timeColor}; line-height: 1;">${startTime}</div>
                ${endTime ? `<div style="font-size: 8px; opacity: 0.3; margin-top: 2px;">${endTime}</div>` : ''}
            </div>
        </div>

        <div class="duration-box" style="text-align: center; display: flex; flex-direction: column; justify-content: center; flex: 0.7;">
            <span style="font-size: 10px; font-weight: 700; color: #eee; display: block;">
                ${ex.duration.replace(' H ', 'Ø³ ').replace(' M', 'Ø¯')}
            </span>
            <span style="font-size: 8px; opacity: 0.3; display: block;">${ex.actual_size} Ø·</span>
        </div>

        <div class="actions" style="display: flex; justify-content: center; align-items: center; flex: 0.4;">
            <button class="btn-action btn-save ${isSaved ? 'saved' : ''}" onclick="toggleSave('${ex.code}')" style="box-shadow: 0 4px 10px rgba(0,0,0,0.2); width: 32px; height: 32px;">
                <i class="fa-solid ${isSaved ? 'fa-xmark' : 'fa-plus'}"></i>
            </button>
        </div>
    `;
    return row;
}
        
       function renderMySchedule() {
    const container = document.getElementById('myRows');
    const section = document.getElementById('myScheduleSection');
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙØ§Ø±ØºØ§Ù‹ØŒ Ø£Ø®ÙÙ Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ø®Ø±Ø¬
    if (myExams.length === 0) { 
        section.style.display = 'none'; 
        return; 
    }

    section.style.display = 'block';
    container.innerHTML = '';
    
    // 1. ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹: Ù…Ù† Ø§Ù„Ø£Ù‚Ø±Ø¨ ØªØ§Ø±ÙŠØ®Ø§Ù‹ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¨Ø¹Ø¯
    myExams.sort((a, b) => {
        const dateA = dayjs(a.date.split(' ')[0], 'DD-MM-YYYY');
        const dateB = dayjs(b.date.split(' ')[0], 'DD-MM-YYYY');
        return dateA - dateB;
    });

    // 2. Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…Ø±ØªØ¨Ø© ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    myExams.forEach(ex => container.appendChild(createRow(ex, true)));
    
    // 3. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ø£Ù‚Ø±Ø¨ Ø§Ø®ØªØ¨Ø§Ø± Ù‚Ø§Ø¯Ù… (ÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©)
    const nextExam = myExams.find(ex => {
        const examDate = dayjs(ex.date.split(' ')[0], 'DD-MM-YYYY');
        return examDate.isAfter(dayjs().subtract(1, 'day')); // ÙŠØ¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø± ØªØ§Ø±ÙŠØ®Ù‡ Ø§Ù„ÙŠÙˆÙ… Ø£Ùˆ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹
    });
    
    if (nextExam) {
        updateCountdown(nextExam.date);
    } else {
        // ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù†Øª ÙƒÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª
        document.getElementById('countdown').innerText = "âœ… Ø§ÙƒØªÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ø®ØªØ¨Ø§Ø±Ø§ØªÙƒ.. Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚!";
    }
}

        function doSearch() {
    // 1. Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Øµ Ø§Ù„Ø¨Ø­Ø«: ØªØ­ÙˆÙŠÙ„ Ù„ØµØºÙŠØ± ÙˆØ¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
    const q = document.getElementById('searchInput').value.toLowerCase().replace(/\s+/g, '');
    const container = document.getElementById('searchRows');
    const header = document.getElementById('searchHeader');
    
    // Ø¥Ø°Ø§ Ø§Ù„Ø¨Ø­Ø« ÙØ§Ø±ØºØŒ Ù†Ø¸Ù Ø§Ù„Ù…ÙƒØ§Ù† ÙˆØ£Ø®ÙÙ Ø§Ù„Ù‡ÙŠØ¯Ø±
    if (!q) {
        container.innerHTML = '<div style="text-align: center; padding: 60px; opacity: 0.3;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¢Ù† Ø¹Ù† Ø§Ø®ØªØ¨Ø§Ø±Ùƒ</div>';
        header.style.display = 'none';
        return;
    }

    // 2. Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø°ÙƒÙŠØ©
    const filtered = allExams.filter(e => {
        const codeSafe = e.code.toLowerCase().replace(/\s+/g, '');
        const nameSafe = e.course_name.toLowerCase().replace(/\s+/g, '');
        return codeSafe.includes(q) || nameSafe.includes(q);
    });

    // 3. ØªØ±ØªÙŠØ¨ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ† Ø§Ø­ØªØ±Ø§ÙÙŠ)
    filtered.sort((a, b) => {
        return dayjs(a.date.split(' ')[0], 'DD-MM-YYYY') - dayjs(b.date.split(' ')[0], 'DD-MM-YYYY');
    });

    container.innerHTML = '';

    if (filtered.length > 0) {
        header.style.display = 'grid';
        
        // 4. Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 20 Ù†ØªÙŠØ¬Ø© ÙÙ‚Ø· Ù„Ø¶Ù…Ø§Ù† Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
        filtered.slice(0, 20).forEach(ex => {
            const isSaved = myExams.some(s => s.code === ex.code);
            container.appendChild(createRow(ex, isSaved));
        });

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒØ«ÙŠØ±Ø©ØŒ Ù†Ø¨Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (filtered.length > 20) {
            const tip = document.createElement('div');
            tip.style = "text-align:center; padding:10px; font-size:10px; opacity:0.5;";
            tip.innerText = `ÙŠÙˆØ¬Ø¯ ${filtered.length - 20} Ù†ØªØ§Ø¦Ø¬ Ø¥Ø¶Ø§ÙÙŠØ©ØŒ Ø®ØµØµ Ø¨Ø­Ø«Ùƒ Ø£ÙƒØ«Ø±...`;
            container.appendChild(tip);
        }
    } else {
        header.style.display = 'none';
        container.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.5;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©</div>';
    }
}

        function toggleSave(code) {
    // 1. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø§Ø¯Ø© ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© "Ø¬Ø¯ÙˆÙ„ÙŠ"
    const index = myExams.findIndex(e => e.code === code);
    
    if (index > -1) {
        // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø­Ø°ÙÙ‡Ø§
        myExams.splice(index, 1);
    } else {
        // Ø¥Ø°Ø§ Ø§Ù„Ù…Ø§Ø¯Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù†Ù‡Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© ÙˆÙ†Ø¶ÙŠÙÙ‡Ø§
        const exam = allExams.find(e => e.code === code);
        if (exam) {
            myExams.push(exam);
        }
    }

    // 2. Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø°ÙƒÙŠ (Sorting):
    // Ù†Ù‚ÙˆÙ… Ø¨ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ù‚Ø¨Ù„ Ø­ÙØ¸Ù‡Ø§ ÙˆØ¹Ø±Ø¶Ù‡Ø§
    myExams.sort((a, b) => {
        const dateA = dayjs(a.date.split(' ')[0], 'DD-MM-YYYY');
        const dateB = dayjs(b.date.split(' ')[0], 'DD-MM-YYYY');
        return dateA - dateB;
    });

    // 3. Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¯Ø§Ø¦Ù… (Local Storage):
    // Ù†Ø­ÙØ¸ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø±ØªØ¨Ø© ÙÙŠ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªØµÙØ­ Ù„ØªØ¨Ù‚Ù‰ Ø­ØªÙ‰ Ø¨Ø¹Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
    localStorage.setItem('yic_saved_exams', JSON.stringify(myExams));
    
    // 4. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©:
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØªØ­Ø¯ÙŠØ« Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (Ù„ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø²Ø± Ù…Ù† + Ø¥Ù„Ù‰ X)
    renderMySchedule();
    doSearch();
}

        function updateCountdown() {
    const el = document.getElementById('countdown');
    
    // Ø¥Ø°Ø§ Ù…Ø§ ÙÙŠÙ‡ Ù…ÙˆØ§Ø¯ Ù…Ø¶Ø§ÙØ© Ø£ØµÙ„Ø§Ù‹
    if (myExams.length === 0) {
        el.style.display = 'none';
        return;
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù… ÙŠÙ†ØªÙ‡Ù Ø¨Ø¹Ø¯ (ØªØ§Ø±ÙŠØ®Ù‡ Ø§Ù„ÙŠÙˆÙ… Ø£Ùˆ Ù…Ø³ØªÙ‚Ø¨Ù„Ø§Ù‹)
    const nextExam = myExams.find(ex => {
        const examDate = dayjs(ex.date.split(' ')[0], 'DD-MM-YYYY');
        return examDate.isAfter(dayjs().subtract(1, 'day'));
    });

    el.style.display = 'block';

    if (nextExam) {
        const target = dayjs(nextExam.date.split(' ')[0], 'DD-MM-YYYY');
        const diff = target.diff(dayjs().startOf('day'), 'day');
        const dateNum = nextExam.date.split(' ')[0];

        if (diff > 0) {
           el.innerHTML = `ğŸš€ Ù…ØªØ¨Ù‚ÙŠ <span style="color:#ffd166">${diff}</span> ÙŠÙˆÙ… Ø¹Ù„Ù‰ Ø§Ø®ØªØ¨Ø§Ø± <span style="color:#8042ff">${nextExam.code}</span>`;
        } else {
            el.innerHTML = `ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ… (<span style="color:#ffd166">${nextExam.code}</span>)! ÙØ§Ù„Ùƒ Ø§Ù„ØªÙˆÙÙŠÙ‚`;
        }
    } else {
        el.innerText = `âœ… Ø§Ù†ØªÙ‡Øª Ø¬Ù…ÙŠØ¹ Ø§Ø®ØªØ¨Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ø¶Ø§ÙØ©.. Ù…Ø¨Ø±ÙˆÙƒ!`;
        el.style.background = 'var(--accent)'; // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ù„Ù„Ø£Ø®Ø¶Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²
    }
}

        document.getElementById('searchInput').addEventListener('input', doSearch);
        window.onload = loadData;
    </script>
</body>
</html>
